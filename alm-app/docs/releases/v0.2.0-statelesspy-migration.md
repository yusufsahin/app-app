# v0.2.0 — Statelesspy migration & observability

Release date: _TBD_  
Plan: Statelesspy migration improvements (tasarım + UX/observability).

## Summary

- **Tek motor:** Geçiş grafiği ve permitted triggers tek kaynaktan geliyor: statelesspy adapter (`workflow_sm`). MPC tarafında sadece policy/ACL kullanılıyor; `get_workflow_engine` ve `_SimpleWorkflowEngine` kaldırıldı.
- **Bulk transition UX:** Ortak permitted trigger (intersection), per-artifact hata listesi, `results` alanı (`ok` | `validation_error` | `policy_denied` | `conflict_error`). UI’da başarısız satırlar için sonuç tipi (Policy denied, Validation, Conflict) gösteriliyor.
- **PolicyDeniedError:** Geçiş grafikte geçerli ancak policy/ACL reddinde ayrı exception; batch cevabında `results[id]=policy_denied`; API 422 + `error_type: /errors/policy-denied`.
- **Observability:** `alm_artifact_transition_total` (result label’ları), `alm_artifact_transition_duration_seconds` histogram, yapılandırılmış log (trigger dahil), OpenTelemetry span attribute’ları. `GET /metrics/` endpoint eklendi.
- **Dokümantasyon:** [TRANSITION_OBSERVABILITY.md](../TRANSITION_OBSERVABILITY.md), [WORKFLOW_ENGINE_BOUNDARY.md](../WORKFLOW_ENGINE_BOUNDARY.md) ve [MPC_BOUNDARY.md](../MPC_BOUNDARY.md) güncellendi; plan tamamlanan maddeler bölümü eklendi.

## Backend

- `alm.artifact.domain.mpc_resolver`: `get_workflow_engine`, `_get_workflow_engine_fallback`, `_SimpleWorkflowEngine` kaldırıldı.
- `alm.shared.domain.exceptions`: `PolicyDeniedError(ValidationError)` eklendi.
- `TransitionArtifactHandler`: policy ihlalinde `PolicyDeniedError`; metrikler (success/validation_error/policy_denied/conflict_error); süre histogram; log ve span’e `trigger` eklendi.
- Batch transition router: `PolicyDeniedError` yakalanıyor; `results[artifact_id]=policy_denied`.
- `main.py`: Prometheus `make_asgi_app()` ile `/metrics` mount; artifact metrics modülü import.
- Unit testler: `test_mpc_resolver` workflow_sm tabanlı; `test_policy_violation_raises_policy_denied_error`; `test_batch_transition_artifacts` `results` assert.

## Frontend

- Bulk transition sonuç state’ine `results` eklendi; hata listesinde sonuç tipi (Chip) gösteriliyor.
- `commonTriggers` useMemo optional chaining ile TypeScript güvenli hale getirildi.
- `artifactApi.test.ts`: `BatchResultResponse` için `ok`, `policy_denied`, `validation_error`, `conflict_error` şekil testleri eklendi.

## Docs

- **TRANSITION_OBSERVABILITY.md:** Metrikler, log, tracing, `/metrics/` endpoint.
- **WORKFLOW_API.md:** Batch yanıtında `policy_denied`; ilgili dokümanlar güncellendi.
- **MPC_BOUNDARY.md:** ALM’de statelesspy kullanımı notu; WorkflowEngine satırı güncellendi.
- **docs/README.md:** TRANSITION_OBSERVABILITY indekse ve hızlı yönlendirmeye eklendi.
